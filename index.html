<!DOCTYPE html>
<meta charset="utf-8">
<html>
  <head>
  </head>

  <body>
    <h1>National Parks in the U.S.</h1>
    <p>This map's information came from the
      <a href="https://www.kaggle.com/nationalparkservice/park-biodiversity/data">
        National Park Service
      </a>
    </p>
    <div id="map"></div>
  </body>
</html>


<style>

  h1, p {
    text-align: center;
    color: red;
  }

  p {
    font-size: 20px;
  }

  a {
    text-decoration: none;
    color: #990000;
  }

  a:hover {
    color: #cecece;
  }

  path {
    fill: #cecece;
    stroke: white;
  }

  /*
  Followed http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html
  tutorial while creating the tooltip
  */
  div.tooltip {
    position: absolute;
    text-align: center;
    color: #909090;
    width: 160px;
    height: 55px;
    padding: 2px;
    font: 14px;
    background: white;
    border: 0px;
    border-radius: 4px;
    pointer-events: none;
  }

  .legend {
    position: absolute;
    top: 350px;
  }

  body {
    color: #909090;
  }

</style>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script>
// make list of possible animal choices
var animal_dict = {
  "Grey Wolf": "Canis lupus",
  "Black Bear": "Ursus americanus",
  "North American Bison": "Bison bison",
  "Moose": "Alces alces",
  "Cougar": "Puma concolor",
  "Seal": "Phoca vitulina",
  "Whale": "Megaptera novaeangliae",
};

// make list of possible animal choices
var animals=Object.keys(animal_dict);
// For use in the Scientific Name column then grab the Park Name
var animal_sci=Object.values(animal_dict);
// Make dictionary of animal


console.log(animals);
var color = d3.scaleOrdinal(d3["schemeCategory10"]);
var legendHeight = d3.ticks(0, 20*(animals.length-1) , animals.length-1);

// initialize width and height
var width = window.innerWidth - 50;
var height = window.innerHeight - 300;

// Create svg
var svg = d3.select("#map")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

// D3 Projection
var projection = d3.geoAlbersUsa()
            .translate([width/2, height/2])
            .scale(1000);

// create path
var path = d3.geoPath()
    .projection(projection);

// allows objects to be in front of map
var g = svg.append("g");

// Add tooltip
var div = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

// Legend Code from Mike Bostock: http://bl.ocks.org/mbostock/3888852
var legend = d3.select("body").append("svg")
      		.attr("class", "legend")
     			.attr("width", 200)
    			.attr("height", 20*animals.length)
   			.selectAll("g")
   				.data(legendHeight)
   			.enter()
   				.append("g")
     			.attr("transform", function(data) {
            return "translate(0," + data + ")";
          });

  	legend.append("rect")
   		  .attr("width", 18)
   		  .attr("height", 18)
        .attr("fill", function(data, i) {
          console.log(i)
          return color(i);
        });

  	legend.append("text")
  		  .data(animals)
      	  .attr("x", 24)
      	  .attr("y", 9)
      	  .attr("dy", ".35em")
      	  .text( function(animals) {
            return animals;
          })
          // Add tooltip
          .on("mouseover", function(data) {
            console.log(data);

          })
          .on("mouseout", function(data) {
              console.log("out");
              console.log(data);
          });

d3.json("https://gist.githubusercontent.com/mbostock/4090846/raw/07e73f3c2d21558489604a0bc434b3a5cf41a867/us.json",
function(error, us) {
  if (error) throw error;

  g.selectAll("path")
      .data(topojson.feature(us, us.objects.states).features)
    .enter().append("path")
      .attr("d", path)
      .attr("class", "feature");

  g.append("path")
      .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
      .attr("class", "mesh")
      .attr("d", path);
});

d3.csv("https://gist.githubusercontent.com/meyerpa/1a5b1c3388e73ce2870c70fe2d42e55b/raw/89d66bdbb1f4af9a7c12afd1fd0aed1d27ca5f39/parks.csv",
    function(data) {
      return {
        parkName: data['Park Name'],
        latitude: parseInt(data['Latitude']),
        longitude: parseInt(data['Longitude']),
        size: parseInt(data['Acres'])
      };
    }, function(data) {
  svg.selectAll("circle")                 // create virtual circle template
    .data(data)                           // bind data
  .enter()                                // for each row in data
    .append("circle")
    .attr('id', function(data) { return data.parkName})
    .attr("r", function(data) {
      return Math.log(data.size/1000);
    })
    .attr("cx", function(data) {
      // Map longitude and latitude onto map, return null if outside
      var x = projection([data.longitude, data.latitude]);
      return (x == null ? null:  x[0]);
    })
    .attr("cy", function(data) {
      // Map longitude and latitude onto map, return null if outside
      var y = projection([data.longitude, data.latitude]);
      return (y == null ? null:  y[1]);
    })
    .attr("class", "nat-park")
    .style("fill", "red")
    .style("opacity", 0.85)
    // Add tooltip
    .on("mouseover", function(data) {
      div.transition()
        .duration(300)
        .style("opacity", 0.97);
        div.text(data.parkName)
        .style("left", (d3.event.pageX) + "px")
        .style("top", (d3.event.pageY- 7) + "px");

    })
    .on("mouseout", function(data) {
        div.transition()
           .duration(300)
           .style("opacity", 0);
    })
  });

  var species_csv = "https://gist.github.com/meyerpa/dd799c36fe0ee80e1160f9a44c538236/raw/5251e7794f82dafb23384794eecfc9fa3f63bcae/species.csv";
  d3.csv(species_csv,
      function(data) {
        return {
          parkName: data['Park Name'],
          species: data['Scientific Name']
        };
      }, function(data) {
        console.log(data);
      });


</script>
